<div id="categories-section" class="container-fluid main">
    <header class="page-header">
        <p class="subhead">{{ workCtrl.work.medium_pretty }}</p>
        <h1>{{ workCtrl.work.title }} ({{ workCtrl.work.composition_date_string }})</h1>
    </header>

    <article class="categories">

        <div class="container">
            <div class="section-group" ng-bind-html="workCtrl.work.info | highlight:workCtrl.searchTerm"></div>
            <hr>
            <p class="text-center"><em>Dates are the probable dates of {{ workCtrl.work.probable }}.</em></p>

            <div class="row" ng-repeat="increment in workCtrl.rows">

                <!-- For Non virtual groups -->
                <div ng-repeat="copy in workCtrl.copies | limitTo:4:(increment * 4) - 4" class="col-sm-6 col-md-3" ng-if="workCtrl.work.virtual == false">
                    <handprint-block
                            link="/blake/copy/{{copy.bad_id}}"
                            image="{{ copy.image }}.100.jpg"
                            footer="Copy {{copy.archive_copy_id}} {{copy.source.objinfo.printdate['#text']}}, ({{copy.institution}})">
                    </handprint-block>
                </div>

                <!-- For Virtual Groups, except letters -->
                <div ng-repeat="obj in workCtrl.objects | limitTo:4:(increment * 4) - 4" class="col-sm-6 col-md-3" ng-if="workCtrl.work.virtual == true && workCtrl.work.bad_id != 'letters'">

                    <handprint-block
                            link="/blake/copy/{{obj.archive_copy_id}}?descId={{obj.desc_id}}"
                            image="{{ obj.dbi }}.100.jpg"
                            footer="{{obj.full_object_id}}, {{obj.source.objdescid.compdate['#text']}}, ({{obj.source.provenance.name['#text']}})">
                    </handprint-block>
                </div>

                <!-- For Letters -->
                <div ng-repeat="obj in workCtrl.objects | limitTo:4:(increment * 4) - 4" class="col-sm-6 col-md-3" ng-if="workCtrl.work.bad_id == 'letters'">
                    <handprint-block
                            link="/blake/copy/{{obj.archive_copy_id}}?descId={{obj.desc_id}}"
                            image="{{ obj.dbi }}.100.jpg"
                            footer="{{obj.object_group}}">
                    </handprint-block>
                </div>

            </div>
            
        </div>
    </article>
</div>
<div class="container-bottom">
    <div class="container">
        <div class="section-group">
            <h2>Related Works</h2>
            <p>Related works currently available in the William Blake Archive appear as links below. Works not currently available appear as plain text.</p>
        </div>
        <div class="section-group" ng-if="workCtrl.work.medium=='illbk'">
            <h3>All Known Copies</h3>
            <div class="row">
            <!--<div class="row" ng-class="workCtrl.workCtrl.copies.length > 2 ? 'columns' : 'columns-short'">-->
                <div class="col-sm-4">
                    <p ng-repeat="copy in workCtrl.copies | limitTo:workCtrl.knownCopiesDiv3">
                        <a href="/blake/copy/{{ copy.bad_id }}">Copy {{ copy.archive_copy_id }}, {{ copy.composition_date }}</a>
                        <br/>
                        {{ copy.institution }}
                        <br/>
                        {{ copy.source.repository.addressline[0]['#text'] }}<br>
                        {{ copy.source.repository.addressline[1]['#text'] }}<br>
                        {{ copy.source.repository.addressline[2]['#text'] }}
                    </p>
                </div>
                <div class="col-sm-4">
                    <p ng-repeat="copy in workCtrl.copies | limitTo:workCtrl.knownCopiesDiv3:(workCtrl.knownCopiesDiv3 * 2) - workCtrl.knownCopiesDiv3">
                        <a href="/blake/copy/{{ copy.bad_id }}">Copy {{ copy.archive_copy_id }}, {{ copy.composition_date }}</a>
                        <br/>
                        {{ copy.institution }}
                        <br/>
                        {{ copy.source.repository.addressline[0]['#text'] }}<br>
                        {{ copy.source.repository.addressline[1]['#text'] }}<br>
                        {{ copy.source.repository.addressline[2]['#text'] }}
                    </p>
                </div>
                <div class="col-sm-4">
                    <p ng-repeat="copy in workCtrl.copies | limitTo:workCtrl.knownCopiesDiv3:(workCtrl.knownCopiesDiv3 * 3) - workCtrl.knownCopiesDiv3">
                        <a href="/blake/copy/{{ copy.bad_id }}">Copy {{ copy.archive_copy_id }}, {{ copy.composition_date }}</a>
                        <br/>
                        {{ copy.institution }}
                        <br/>
                        {{ copy.source.repository.addressline[0]['#text'] }}<br>
                        {{ copy.source.repository.addressline[1]['#text'] }}<br>
                        {{ copy.source.repository.addressline[2]['#text'] }}
                    </p>
                </div>
            <!--</div>-->
            </div>
        </div>
        <div class="section-group" ng-class="workCtrl.work.related_works.length > 0 ? '' : 'hidden'">
            <h3>All Known Related Items</h3>
            <div class="row">
                <!--<div class="row" ng-class="workCtrl.work.related_works.length > 2 ? 'columns' : 'columns-short'">-->
                <div class="col-sm-4">
                    <p ng-repeat="relatedWork in workCtrl.work.related_works | limitTo:workCtrl.allKnownRelatedItemsDiv3">
                        <span ng-if="relatedWork.title.type == 'copy'"><a href="/blake/copy/{{ relatedWork.title.link }}">{{ relatedWork.title.text }}</a></span>
                        <span ng-if="relatedWork.title.type == 'object'"><a href="/blake/copy/{{ workCtrl.objectCopyId(relatedWork.title.link) }}?descId={{ relatedWork.title.link }}">{{ relatedWork.title.text }}</a></span>
                        <span ng-if="!relatedWork.title.type">{{ relatedWork.title.text }}</span>
                        <br ng-if="workCtrl.isValidTitle(relatedWork.title.text)"/>
                        <span ng-if="relatedWork.info" ng-bind-html="relatedWork.info"></span>
                    </p>
                </div>
                <div class="col-sm-4">
                    <p ng-repeat="relatedWork in workCtrl.work.related_works | limitTo:workCtrl.allKnownRelatedItemsDiv3:(workCtrl.allKnownRelatedItemsDiv3 * 2) - workCtrl.allKnownRelatedItemsDiv3">
                        <span ng-if="relatedWork.title.type == 'copy'"><a href="/blake/copy/{{ relatedWork.title.link }}">{{ relatedWork.title.text }}</a></span>
                        <span ng-if="relatedWork.title.type == 'object'"><a href="/blake/copy/{{ workCtrl.objectCopyId(relatedWork.title.link) }}?descId={{ relatedWork.title.link }}">{{ relatedWork.title.text }}</a></span>
                        <span ng-if="!relatedWork.title.type">{{ relatedWork.title.text }}</span>
                        <br ng-if="workCtrl.isValidTitle(relatedWork.title.text)"/>
                        <span ng-if="relatedWork.info" ng-bind-html="relatedWork.info"></span>
                    </p>
                </div>
                <div class="col-sm-4">
                    <p ng-repeat="relatedWork in workCtrl.work.related_works | limitTo:workCtrl.allKnownRelatedItemsDiv3:(workCtrl.allKnownRelatedItemsDiv3 * 3) - workCtrl.allKnownRelatedItemsDiv3">
                        <span ng-if="relatedWork.title.type == 'copy'"><a href="/blake/copy/{{ relatedWork.title.link }}">{{ relatedWork.title.text }}</a></span>
                        <span ng-if="relatedWork.title.type == 'object'"><a href="/blake/copy/{{ workCtrl.objectCopyId(relatedWork.title.link) }}?descId={{ relatedWork.title.link }}">{{ relatedWork.title.text }}</a></span>
                        <span ng-if="!relatedWork.title.type">{{ relatedWork.title.text }}</span>
                        <br ng-if="workCtrl.isValidTitle(relatedWork.title.text)"/>
                        <span ng-if="relatedWork.info" ng-bind-html="relatedWork.info"></span>
                    </p>
                </div>
                <!--</div>-->
            </div>
        </div>
    </div>
</div>
